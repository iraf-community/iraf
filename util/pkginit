#!/bin/bash
#
#  PKGINIT - Initialize the dynamic package directory by fetching the most
#  recent repository definition files.

bindir="`dirname $0`"                # get iraf root directory 
irafdir=${iraf}/

# Initialize the $iraf and environment.
if [ -z "$iraf" ]; then
  if [ -e "$HOME/.iraf/setup.sh" ]; then
    source $HOME/.iraf/setup.sh
  else
    source ${irafdir}/unix/hlib/setup.sh
  fi
else
    source $iraf/unix/hlib/setup.sh
fi


REPO=`${irafdir}/util/pkgrepo`			# get repo url

# Get the manifest file from the repository.
$irafdir/util/pkgget ${REPO}/MANIFEST
if (( $?>0 )); then
    /bin/echo "Cannot download repository manifest file, quitting."
    exit $?
else
    mv MANIFEST .repo_manifest
fi

# Get the package list file from the repository.
$irafdir/util/pkgget ${REPO}/REPO.PKGS
if (( $?>0 )); then
    /bin/echo "Cannot download repository package list file, quitting."
    exit $?
else
    mv REPO.PKGS .repo_pkgs
fi

exit 0
